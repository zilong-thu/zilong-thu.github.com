<!doctype html>
<html>
<head>
	<title>个人所得税计算器</title>
	<meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no, width=device-width" />
	<link rel="stylesheet" type="text/css" href="css/android.css">
	<script src="/javascripts/modernizr-2.0.js"></script>
	<script type="text/javascript" src="tax.js"></script>
</head>
<body>
	<h1>个人所得税计算器</h1>
<div id="tax-container">
	<div class="row">
		<label class="label title">税前收入</label>
		<input type="number" class="inputs input-lg" id="salary-in"/><span>元</span>
	</div>

	<div class="row">
		<label class="label title">五险一金</label>
		<span id="ins-radio-group"><span class="radio radio-selected" data-name="user">手动输入</span><span class="radio" data-name="detail">详细计算</span></span>
	</div>
	<div class="row">
		<label id="label-placeholder" class="label title" style="height: 0px;"> </label>
		<input type="number" class="inputs input-lg" id="insurance"/><span>元</span>
	</div>


	<div id="insurance-details" style="display: none;">
		<p>
			<label class="label">选择城市</label>
			<select id="select-city" class="inputs input-sm">
				<option value="---">---</option>
				<option value="Beijing">北京</option>
				<option value="Shanghai">上海</option>
				<option value="Nanjing">南京</option>
			</select>
		</p>
		<p>
			<label class="label">养老保险</label>
			<input type="number" id="insurance_old" class="input-sm" >%
		</p>
		<p>
			<label class="label">医疗保险</label>
			<input type="number" id="insurance_medical" class="input-sm">%
		</p>
		<p>
			<label class="label">失业保险</label>
			<input type="number" id="insurance_loseJob" class="input-sm">%
		</p>
		<p>
			<label class="label">工伤保险</label>
			<input type="number" id="insurance_injure" class="input-sm">%
		</p>
		<p>
			<label class="label">生育保险</label>
			<input type="number"  id="insurance_baby" class="input-sm">%
		</p>
		<p>
			<label class="label">公积金</label>
			<input type="number" id="insurance_providentFund" class="input-sm">%
		</p>
	</div>
		
		
	<div>
		<button id="calc-button" type="button" class="btn btn-primary calc"> 开始计算 </button>
	</div>

	<div id="result">
	</div>

	<div class="footer">&copy; Copyright by <a href="http://www.borninsummer.com/" target="_blank">王子龙</a> 2014</div>
</div>

<script type="text/javascript">
(function(){
	var calcButton = document.getElementById('calc-button');
	calcButton.onclick = function(e){
		var e = e || window.event;
		Tax.getSalaryIn().getInsurance().calcTax();
		if(e.stopPropogation){
			e.stopPropogation();
		} else if(e.cancelBubble){
			e.cancelBubble = true;
		}

	};

	document.addEventListener('click', function(e){
		var target = e.target;
		var parent = target.parentNode,
			spans  = parent.children;

		// 响应自制的radio按钮
		if(parent.id === 'ins-radio-group'){
			for(var i=0, length = spans.length; i<length; i++){
				spans[i].setAttribute('class', 'radio');
			}
			target.setAttribute('class' , 'radio radio-selected');

			// 使详细计算div可见
			var insDetails = document.getElementById('insurance-details');
			if(target.dataset['name'] === 'user'){
				Tax.insuranceMethod = 'user';
				insDetails.setAttribute('style', 'display: none;');
			} else{
				Tax.insuranceMethod = 'city';
				insDetails.setAttribute('style', '');
			}
		}
	}, false);

	// 根据城市，计算计税额度
	var selectCity = document.getElementById('select-city');
	selectCity.onchange = function(e){
		var city = selectCity.value;
		var inputElements = document.querySelectorAll('#insurance-details input[class="input-sm"]');
		var insCity = Tax.insuranceCity[city];
		if(insCity){
			for(var i=0, len= inputElements.length; i< len; i++){
				inputElements[i].value = insCity[i];
			}

			Tax.calcInsurance();
		}
	};

	// 改变税前收入时，更新计税额度
	var input_salaryIn = document.getElementById('salary-in');
	input_salaryIn.onchange = function(e){
		if(Tax.insuranceMethod === 'city'){
			var city = selectCity.value;
			if(city !== '---'){
				Tax.calcInsurance();
			}
		}
	};
})();
</script>
</body>
</html>